<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Utenti Simili - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-3">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
</div>

<div class="container py-4">
    <h1 class="text-center mb-4">Utenti filtrati e ordinati</h1>

    <!-- Filtri -->
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-3">
            <input type="text" class="form-control" name="city" placeholder="Città" value="{{ filters.city }}">
        </div>
        <div class="col-md-3">
            <input type="number" class="form-control" name="min_followers" placeholder="Min Followers" value="{{ filters.min_followers }}">
        </div>
        <div class="col-md-3">
            <input type="text" class="form-control" name="keyword" placeholder="Keyword bio" value="{{ filters.keyword }}">
        </div>
        <div class="col-md-3">
            <select name="sort_by" class="form-select">
                <option value="score" {% if filters.sort_by=='score' %}selected{% endif %}>Ordina per Score</option>
                <option value="followers" {% if filters.sort_by=='followers' %}selected{% endif %}>Ordina per Followers</option>
                <option value="following" {% if filters.sort_by=='following' %}selected{% endif %}>Ordina per Following</option>
            </select>
        </div>
        <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">Applica Filtri</button>
        </div>
    </form>

    <!-- Tabella utenti -->
    <div class="card shadow-lg">
        <div class="card-body table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>Username</th>
                        <th>Bio</th>
                        <th>Location</th>
                        <th>Followers</th>
                        <th>Following</th>
                        <th>Score</th>
                        <th>Azione</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>
                            <a href="{{ user.github_url }}" target="_blank" class="fw-bold text-decoration-none">
                                {{ user.username }}
                            </a>
                        </td>
                        <td>{{ user.bio or "—" }}</td>
                        <td>{{ user.location or "—" }}</td>
                        <td><span class="badge bg-success">{{ user.followers }}</span></td>
                        <td><span class="badge bg-info">{{ user.following }}</span></td>
                        <td><span class="badge bg-dark">{{ user.score }}</span></td>
                        <td>
                            <a href="{{ url_for('follow_user', username=user.username) }}" class="btn btn-sm btn-primary mb-1">Segui</a>
                            {% if user.email_to_notify %}
                            <a href="{{ url_for('send_email', username=user.username) }}" class="btn btn-sm btn-success">Invia Email</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
